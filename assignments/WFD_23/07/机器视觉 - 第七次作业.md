# 机器视觉 - 第七次作业

## 代码

```c++
#include <iostream>
#include <string>
#include <vector>
#include <time.h>
#include "opencv2/opencv.hpp"

#define IMGNUM 19
#define LEVEL 2

using namespace cv;
using namespace std;

void getPyramidLevel(Mat& in, Mat& out, int ksize, float sigma, int level);
void imncc(vector<Mat>& ins, Mat& model, vector<Mat>& nccscores);
void markmatch(Mat& img, Mat& score);

int main(){
    vector<Mat> inImages, grayImages, bluredImages, nccScores;
    Mat model, bluredModel;
    clock_t startclock, endclock;

    cvtColor(imread("../img/model.jpg"), model, COLOR_RGB2GRAY);
    for(int i=0;i<IMGNUM;++i){
        /** 请自行补充 **/
    }

    cout << "图像读取完成，开始计时。\n";
    startclock = clock();
    getPyramidLevel(model, bluredModel, 5, 3, LEVEL);
    for(Mat& img :grayImages){
        /** 请自行补充 **/
    }

    imncc(bluredImages, bluredModel, nccScores);

    for(int i=0;i<IMGNUM;++i){
        markmatch(inImages[i], nccScores[i]);
    }
    endclock = clock();
    cout << "图像匹配、标记完成，计时结束。\n";
    cout << "共用时" << (endclock-startclock)/1e6 << "s，平均用时" << (endclock-startclock)/1e3/IMGNUM << "ms。\n";

    for(int i=0;i<IMGNUM;++i){
        imwrite("../result/out_"+to_string(i)+".jpg", inImages[i]);
    }

    return 0;
}

void getPyramidLevel(Mat& in, Mat& out, int ksize, float sigma, int level){
    Mat tmpImg = in;
    for(int i=1;i<level;++i){
        Mat bluredImg;
        GaussianBlur(tmpImg, bluredImg, Size(ksize, ksize), sigma);
        resize(bluredImg, tmpImg, Size(bluredImg.cols/2, bluredImg.rows/2));
    }
    out = tmpImg;
}

void imncc(vector<Mat>& ins, Mat& model, vector<Mat>& nccscores){
   /** 请自行补充 **/
}

void markmatch(Mat& img, Mat& score){
    /** 请自行补充 **/
}

```

## 效果

使用模板：

![](img/model.jpg)

效果：

| 原图           | 结果图                |
| -------------- | --------------------- |
| ![](img/0.jpg) | ![](result/out_0.jpg) |
| ![](img/1.jpg) | ![](result/out_1.jpg) |
| ![](img/2.jpg) | ![](result/out_2.jpg) |
| ![](img/3.jpg) | ![](result/out_3.jpg) |
| ![](img/4.jpg) | ![](result/out_4.jpg) |
| ![](img/5.jpg) | ![](result/out_5.jpg) |
| ![](img/6.jpg) | ![](result/out_6.jpg) |
| ![](img/7.jpg) | ![](result/out_7.jpg) |
| ![](img/8.jpg) | ![](result/out_8.jpg) |
| ![](img/9.jpg) | ![](result/out_9.jpg) |
| ![](img/10.jpg) | ![](result/out_10.jpg) |
| ![](img/11.jpg) | ![](result/out_11.jpg) |
| ![](img/12.jpg) | ![](result/out_12.jpg) |
| ![](img/13.jpg) | ![](result/out_13.jpg) |
| ![](img/14.jpg) | ![](result/out_14.jpg) |
| ![](img/15.jpg) | ![](result/out_15.jpg) |
| ![](img/16.jpg) | ![](result/out_16.jpg) |
| ![](img/17.jpg) | ![](result/out_17.jpg) |
| ![](img/18.jpg) | ![](result/out_18.jpg) |

终端输出：

![](result/terminal.png)

